<div class="container">
    <div class="row">
        <div class="main_style">
            <div class="line_1"></div>
            <div class="line_2"></div>

            <div class="btn_div">
                <table style="width:80%; border-spacing: 10px;">
                    <tr>
                        <td><span class="text_info">{{ info_message }}</span>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            <label>
                                <input type="checkbox" disabled id="recoveryPassword">
                                <span>Отправить ссылку на восстановление пароля</span>
                            </label>
                        </td>
                        <td></td>
                    </tr>
                    <tr>
                        <td>
                            <button id="saveOfferBtn" type="button" class="btn">Сохранить объявление</button>
                        </td>
                    </tr>
                </table>
            </div>

            <div class="table_personal">
                <table style="width:80%">
                    <tr>
                        <td class="text_personal_obj_name"><a
                                href="{{ parsed_object_model.url }}">{{ parsed_object_model.title }}</a></td>
                        <td class="text_personal_phone">
                            {% for phone in parsed_object_model.phones %}
                                <span>{{ phone }}</span>
                            {% endfor %}
                        </td>
                    </tr>
                    <tr>
                        <td class="text_personal_address"><span>{{ parsed_object_model.address }}</span></td>
                        <td class="text_personal_name">{% if parsed_object_model.contact %}
                            {{ parsed_object_model.contact }}{% endif %}</td>
                    </tr>
                </table>
            </div>

            <form class="ajax-form">
                <table style="width: 50%;">
                    <tr>
                        <td><span class="">Тип сделки</span></td>
                        <td>
                            <select class="select-control" id="getDealType">
                                <option value="not_selected" disabled>Не выбрано</option>
                                <option value="rent" {% if parsed_object_model.is_rent %}selected{% endif %}>Аренда
                                </option>
                                <option value="sale" {% if parsed_object_model.is_sale %}selected{% endif %}>Продажа
                                </option>
                            </select>
                        </td>
                    </tr>

                    <tr>
                        <td><span class="">Тип недвижимости</span></td>
                        <td>
                            <select class="select-control" id="getOfferType">
                                <option value="" disabled>Не выбрано</option>
                                <option value="flat" selected>Жилая</option>
                                <option value="commerce" disabled>Коммерческая</option>
                                <option value="suburban" disabled>Загородная</option>
                                <option value="newobject" disabled>Новостройки</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <td><span class="">Объект</span></td>
                        <td>

                            <select class="select-control" id="getCategoryType">
                                <option value="" selected disabled>Не выбрано</option>
                                <option value=""
                                        {% if parsed_object_model.category.is_flat_sale
                                or parsed_object_model.category.is_flat_rent %}
                                        selected {% endif %}>Квартира
                                </option>
                                <option value=""
                                        {% if parsed_object_model.category.is_room_sale
                                or parsed_object_model.category.is_room_rent %}
                                        selected {% endif %}>Комната
                                </option>
                                <option value="" {% if parsed_object_model.category.is_flat_share_sale %}
                                        selected {% endif %}>
                                    Доля
                                    в квартире
                                </option>
                                <option value="" {% if parsed_object_model.category.is_bed_rent %} selected {% endif %}>
                                    Койко-место (только аренда)
                                </option>
                                <option value="" disabled>Дом/Дача</option>
                                <option value="" disabled>Коттедж</option>
                                <option value="" disabled>Таунхаус</option>
                                <option value="" disabled>Часть дома</option>
                                <option value="" disabled>Участок</option>
                            </select>
                        </td>
                    </tr>

                    <tr></tr>
                    <tr>
                        <td><span class="text_header">Адрес</span></td>
                    </tr>
                    <tr>
                        <td><span class="">Адрес</span></td>
                        <td>
                            <input class="input-control" placeholder="Адрес объекта"
                                   value="{{ parsed_object_model.address }}"
                                   type="text" id="getAddress">
                        </td>
                    </tr>

                    <tr></tr>
                    <tr>
                        <td><span class="text_header">Об объекте</span></td>
                    </tr>

                    {% if parsed_object_model.is_allow_realty_type %}
                        <tr>
                            <td><span class="">Тип жилья</span></td>
                            <td>
                                <select class="select-control" id="getRealtyType">
                                    <option value="" selected disabled>Не выбрано</option>
                                    <option value="flat">Квартира</option>
                                    <option value="apartments">Апартаменты</option>
                                </select>
                            </td>
                        </tr>
                    {% endif %}

                    <tr>
                        <td><span class="">Общая площадь</span></td>
                        <td>
                            <input type="number" value="{{ parsed_object_model.total_area }}"
                                   placeholder="Площать объекта в м2"
                                   class="input-control" id="getTotalArea">
                        </td>
                    </tr>

                    {% if parsed_object_model.is_allow_rooms %}
                        <tr>
                            <td><span class="">Количество комнат</span></td>
                            <td>
                                <select class="select-control" id="getRoomsCount">
                                    <option value="" selected disabled>Не выбрано</option>
                                    <option value="room1">1</option>
                                    <option value="room2">2</option>
                                    <option value="room3">3</option>
                                    <option value="room4">4</option>
                                    <option value="room5">5</option>
                                    <option value="room6_plus">6+</option>
                                    <option value="studio">студия</option>
                                </select>
                            </td>
                        </tr>
                    {% endif %}

                    <tr>
                        <td><span class="">Этаж (необязательно)</span></td>
                        <td>
                            <input type="number" class="input-control" value="{{ parsed_object_model.floor_number }}"
                                   placeholder="Этаж объекта" id="getFloorNumber">
                            <input type="number" class="input-control" value="{{ parsed_object_model.floors_count }}"
                                   placeholder="Общее количество этажей в доме"
                                   id="getFloorCount">
                        </td>

                    </tr>

                    <tr></tr>
                    <tr>
                        <td><span class="text_header">Условия сделки</span></td>
                    </tr>
                    <tr>
                        <td><span class="">Цена</span></td>
                        <td>
                            <input class="input-control" placeholder="Цена объекта в рублях"
                                   value="{{ parsed_object_model.price }}" type="number" id="getPrice">
                        </td>
                    </tr>

                    {% if parsed_object_model.is_sale %}
                        <tr>
                            <td><span class="">Тип продажи</span></td>
                            <td>
                                <select class="select-control" id="getSaleType">
                                    <option value="" selected disabled>Не выбрано</option>
                                    <option value="">Свободная продажа</option>
                                    <option value="">Альтернатива</option>
                                </select>
                            </td>
                        </tr>
                    {% endif %}

                    <tr>
                        <td><span class="text_header">Контакты</span></td>
                    </tr>
                    <tr>
                        <td><span class="">Телефон</span></td>
                        <td>
                            <input class="input-control" placeholder="Реальный телефон владельца"
                                   value="{{ parsed_object_model.phones[0] }}" type="number"
                                   id="getPhoneNumber">
                        </td>
                    </tr>

                </table>
            </form>

        </div>
    </div>
</div>


<script>
    jQuery(($) => {
        const saveOfferBtn = $('#saveOfferBtn');
        const getDealType = $('#getDealType');
        const getOfferType = $('#getOfferType');
        const getCategoryType = $('#getCategoryType');
        const getAddress = $('#getAddress');
        const getRealtyType = $('#getRealtyType');
        const getTotalArea = $('#getTotalArea');
        const getRoomsCount = $('#getRoomsCount');
        const getFloorNumber = $('#getFloorNumber');
        const getFloorCount = $('#getFloorCount');
        const getPrice = $('#getPrice');
        const getSaleType = $('#getSaleType');
        const getPhoneNumber = $('#getPhoneNumber');
        const recoveryPassword = $('#recoveryPassword');
        <!-- Offer end -->

        $('.ajax-form').on('submit', (event) => {
            event.preventDefault();
        });


        let DEBUG = 'True' === '{{ debug }}'
        const saveOffer = () => {
            let obj = {
                deal_type: getDealType.val(),
                offer_type: getOfferType.val(),
                category: getCategoryType.val(),
                address: getAddress.val(),
                realty_type: getRealtyType.val(),
                total_area: parseInt(getTotalArea.val()),
                rooms_count: parseInt(getRoomsCount.val()),
                floor_number: parseInt(getFloorNumber.val()),
                floors_count: parseInt(getFloorCount.val()),
                price: parseInt(getPrice.val()),
                sale_type: getSaleType.val(),
                phone_number: getPhoneNumber.val(),
                recovery_password: recoveryPassword.prop("checked")
            }

            $.post("/api/admin/v1/save-offer/", DEBUG ? JSON.stringify(obj) : obj
            ).then(function (data) {
                switch (data.status) {
                    case 'ok':
                        alert('Объявление успешно создано как черновик');
                        break;
                }
            });
        };


        saveOfferBtn.click(() => {
            saveOffer()
        });

    });

    let meta = document.createElement('meta');
    meta.name = "referrer";
    meta.content = "no-referrer";
    document.getElementsByTagName('head')[0].appendChild(meta);
</script>

<style>
    .main_style {
        height: 1000px;
        background: rgba(255, 255, 255, 1);
        opacity: 1;
        position: relative;
        top: 0px;
        left: 0px;
        overflow: hidden;
    }

    .line_1 {
        width: 840px;
        height: 1px;
        background: rgba(238, 238, 238, 1);
        opacity: 1;
        position: relative;
        top: 17%;
        left: 300px;
    }

    .line_2 {
        width: 840px;
        height: 1px;
        background: rgba(238, 238, 238, 1);
        opacity: 1;
        position: relative;
        top: 70%;
        left: 300px;
    }

    .ajax-form {
        top: 70px;
        left: 300px;
        position: relative;
    }

    .select-control, .input-control {
        width: 300px;
        position: relative;
    }

    table, th, td {
        border: 0;
        width: 40%;
        border-spacing: 20px;
    }

    .text_header {
        font-family: Arial;
        font-weight: Bold;
        font-size: 24px;
        opacity: 1;
        text-align: left;
    }

    .text_info {
        width: 838px;
        color: rgba(111, 111, 111, 1);
        font-family: Arial;
        font-size: 16px;
        opacity: 1;
        text-align: left;
    }

    .btn_div {
        top: 75%;
        left: 300px;
        position: relative;
    }

    .btn {
        width: 840px;
        height: 30px;
        position: relative;
    }

    .table_personal {
        left: 300px;
        position: relative;
    }

    .text_personal_obj_name {
        color: rgba(66, 120, 176, 1);
        font-family: Arial;
        font-weight: Bold;
        font-size: 24px;
        opacity: 1;
        text-align: left;
    }

    .text_personal_phone {
        color: rgba(0, 0, 0, 1);
        font-family: Arial;
        font-weight: Bold;
        font-size: 24px;
        opacity: 1;
        text-align: left;
    }

    .text_personal_name {
        color: rgba(0, 0, 0, 1);
        font-family: Arial;
        font-size: 16px;
        opacity: 1;
        text-align: left;
    }

    .text_personal_address {
        color: rgba(0, 0, 0, 1);
        font-family: Arial;
        font-size: 16px;
        opacity: 1;
        text-align: left;
    }
</style>